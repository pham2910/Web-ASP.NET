@model Models.EF.Review

@{
    var company = ViewBag.comDetail;
}
@using DoAnWeb.Models;
@using Models;


<div class="col-12">
    @{var session = (LoginModel)Session[Constants.USER_SESSION];
        var target = (session != null ? "#exampleModal" : "#errorModal");
     }
    <button type="button" class="btn btn-secondary add" data-bs-toggle="modal" data-bs-target= @target>
        Write a review
    </button>
    <div class="modal fade" id="exampleModal" style="text-align: left" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Write a review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("Write", "Review", FormMethod.Post, new { id = "form-write" }))
                    {
                        @Html.AntiForgeryToken()

                        <div class="form-horizontal">
                            @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                            <div class="form-group">
                                @Html.LabelFor(model => model.Rating, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Rating, new { htmlAttributes = new { @class = "form-control", @id = "rating" } })
                                    @Html.ValidationMessageFor(model => model.Rating, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.Content, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Content, new { htmlAttributes = new { @class = "form-control", @id = "content" } })
                                    @Html.ValidationMessageFor(model => model.Content, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            <div class="form-group">
                                @Html.LabelFor(model => model.Incognito, htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @Html.EditorFor(model => model.Incognito, new { htmlAttributes = new { @class = "form-control", @id = "incognito" } })
                                    @Html.ValidationMessageFor(model => model.Incognito, "", new { @class = "text-danger" })
                                </div>
                            </div>

                            @*<div class="form-group">
                                    <div class="col-md-offset-2 col-md-10">
                                        <input type="submit" value="Create" class="btn btn-default" />
                                    </div>
                                </div>*@
                        </div>
                    }
                </div>
                <div class="modal-footer">
                    @*<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>*@
                    <button id="btnWrite" type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="errorModal"  style="text-align: left" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">Sign in to continue</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    To write a review, you must be signed in. Your identity will remain anonymous.
                </div>
                <div class="modal-footer">
                    @*<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>*@
                    <button id="btnToLogin" type="button" class="btn btn-primary">Go to sign in</button>
                </div>
            </div>
        </div>
    </div>

</div>
<script type="text/javascript" src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(document).ready(function () {
        $("#btnWrite").click(function () {
            var today = new Date();
            var date = today.getFullYear() + '-' + (today.getMonth() + 1) + '-' + today.getDate();
            var newReview = {
                UserId: 0,
                ComId: @company.Id,
                DateCreated: date,
                Rating: $("#rating").val(),
                Content: $("#content").val(),
                Incognito: $("#incognito").val()
            }
            $.ajax({
                url: "/Company/Write",
                type: "POST",
                data: newReview,
                success: function () {
                    alert('success')
                }
            });
        })
    })
</script>